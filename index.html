<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- ICON CHO TRÌNH DUYỆT -->
    <link rel="icon" href="title11d1.png" type="image/png">
    <link rel="apple-touch-icon" href="title11d1.png">
    <title>Hệ Thống Xem Điểm - Lớp 11D1</title>

    <!-- OPEN GRAPH META TAGS - CHO SHARE LINK THUMBNAIL -->
    <meta property="og:title" content="Hệ Thống Xem Điểm - Lớp 11D1">
    <meta property="og:description" content="Lớp 11D1 - Năm Học 2025 - Học Kỳ 1">
    <meta property="og:image" content="title11d1.png"> <!-- Hoặc dùng "anh11d1.jpg" nếu muốn ảnh lớp -->
    <meta property="og:url" content="https://rov230909.github.io/"> <!-- Thay bằng URL thực của bạn -->
    <meta property="og:type" content="website">

    <!-- TWITTER CARD - CHO SHARE TRÊN TWITTER/X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Hệ Thống Xem Điểm - Lớp 11D1">
    <meta name="twitter:description" content="Lớp 11D1 - Năm Học 2025 - Học Kỳ 1">
    <meta name="twitter:image" content="title11d1.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root{--card-w:19em;--card-h:25em}
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        
        /* ẨN THANH CUỘN TRANG HOÀN TOÀN */
        html, body, .container {
            -ms-overflow-style: none;  /* IE & Edge */
            scrollbar-width: none;     /* Firefox */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        html::-webkit-scrollbar,
        body::-webkit-scrollbar,
        .container::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }

        html,body{
            height:100%;
            -webkit-tap-highlight-color:transparent;
            touch-action:pan-y;
        }
        body{
            font-family:'Segoe UI',sans-serif;
            background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
            color:#fff;
            display:flex;
            flex-direction:column;
        }

        .container{
            max-width:1400px;
            margin:auto;
            width:100%;
            flex:1;
            display:flex;
            flex-direction:column;
            padding-bottom:100px;
        }

        .header{
            text-align:center;
            padding:20px 15px 10px;
            flex-shrink:0;
            z-index:10;
        }
        .header h1{
            font-size:2.6em;margin-bottom:8px;
            text-shadow:0 0 20px #9b40fc;
        }
        .header p{font-size:1.1em;opacity:0.9}

        /* BẢNG XẾP HẠNG */
        .ranking-wrapper {
            margin: 20px 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(155, 64, 252, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            max-width: 800px;
            width: 100%;
            align-self: center;
            z-index: 5;
        }

        .ranking-title {
            text-align: center;
            font-size: 1.7em;
            margin-bottom: 15px;
            color: #9b40fc;
            text-shadow: 0 0 10px rgba(155, 64, 252, 0.5);
            font-weight: bold;
        }

        .ranking-table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 12px;
            scrollbar-width: thin;
            scrollbar-color: rgba(155, 64, 252, 0.3) transparent;
        }

        /* THANH CUỘN BẢNG: ĐẸP + TRONG SUỐT */
        .ranking-table-container::-webkit-scrollbar {
            width: 10px;
        }
        .ranking-table-container::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 10px;
            margin: 4px 0;
        }
        .ranking-table-container::-webkit-scrollbar-thumb {
            background: rgba(155, 64, 252, 0.3);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
            transition: all 0.3s ease;
        }
        .ranking-table-container::-webkit-scrollbar-thumb:hover {
            background: rgba(155, 64, 252, 0.6);
            box-shadow: 0 0 10px rgba(155, 64, 252, 0.5);
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .ranking-table th {
            background: rgba(155, 64, 252, 0.3);
            color: #fff;
            padding: 14px 10px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .ranking-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ranking-table tr:hover {
            background: rgba(155, 64, 252, 0.15);
            transition: 0.3s;
        }

        .rank-badge {
            display: inline-block;
            width: 32px;
            height: 32px;
            line-height: 32px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.95em;
            color: white;
        }

        .rank-1 { background: linear-gradient(45deg, #ffd700, #ffaa00); box-shadow: 0 0 18px #ffd700; }
        .rank-2 { background: linear-gradient(45deg, #c0c0c0, #aaaaaa); box-shadow: 0 0 15px #c0c0c0; }
        .rank-3 { background: linear-gradient(45deg, #cd7f32, #a97142); box-shadow: 0 0 15px #cd7f32; }
        .rank-other { background: rgba(155, 64, 252, 0.7); }

        .student-name-rank {
            font-weight: 600;
            color: #e0e0ff;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .avg-score {
            font-weight: bold;
            color: #9b40fc;
            font-size: 1.1em;
        }

        .loading-rank {
            text-align: center;
            color: #aaa;
            font-style: italic;
            padding: 30px;
            font-size: 1.1em;
        }

        /* GRID HỌC SINH */
        .grid{
            padding: 20px 10px 30px;
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(var(--card-w),1fr));
            gap:2em;
            justify-content:center;
            scrollbar-width:none;
        }
        .grid::-webkit-scrollbar{display:none}

        /* CARD */
        .card{
            position:relative;
            width:var(--card-w);height:var(--card-h);
            margin:0 auto;
            display:flex;flex-direction:column;
            align-items:center;justify-content:center;
            background:#171717;color:white;
            font-family:Montserrat,sans-serif;font-weight:bold;
            padding:1em 2em 1em 1em;
            border-radius:20px;overflow:hidden;
            cursor:pointer;z-index:1;
            row-gap:1em;
            transition:transform .4s ease;
            box-shadow:0 10px 30px rgba(0,0,0,.5);
        }
        .card:hover{transform:translateY(-12px)}
        .card img{
            width:12em;
            margin-right:1em;
            animation:move 10s ease-in-out infinite;
            z-index:5;
            user-select:none;
            pointer-events:none;
        }

        .card::before{
            content:"";
            position:absolute;
            width:100%;height:100%;
            inset:-3px;
            border-radius:10px;
            background:radial-gradient(#858585,transparent,transparent);
            transform:translate(-5px,250px);
            transition:.4s ease-in-out;
            z-index:-1;
        }
        .card:hover::before{
            width:150%;height:100%;
            margin-left:-4.25em;
        }
        .card::after{
            content:"";
            position:absolute;
            inset:2px;
            border-radius:20px;
            background:rgba(23,23,23,.7);
            transition:all .4s ease-in-out;
            z-index:-1;
        }

        .heading{
            z-index:2;
            transition:.4s ease-in-out;
            font-size:1.35em;
            text-align:center;
            text-shadow:0 2px 10px #000;
        }
        .card:hover .heading{letter-spacing:.025em}

        .heading::before,.icons::before,.icons::after{
            content:"";
            position:absolute;top:0;left:0;
            width:2px;height:2px;
            border-radius:50%;
            opacity:1;
            z-index:-1;
            animation:1s glowing-stars linear alternate infinite;
        }
        .heading::before{box-shadow:220px 118px #fff,280px 176px #fff,40px 50px #fff,60px 180px #fff,120px 130px #fff,180px 176px #fff,220px 290px #fff,520px 250px #fff,400px 220px #fff,50px 350px #fff,10px 230px #fff;}
        .icons::before{box-shadow:140px 20px #fff,425px 20px #fff,70px 120px #fff,20px 130px #fff,110px 80px #fff,280px 80px #fff,250px 350px #fff,280px 230px #fff,220px 190px #fff,450px 100px #fff,380px 80px #fff,520px 50px #fff;animation-delay:.4s;}
        .icons::after{box-shadow:490px 330px #fff,420px 300px #fff,320px 280px #fff,380px 350px #fff,546px 170px #fff,420px 180px #fff,370px 150px #fff,200px 250px #fff,80px 20px #fff,190px 50px #fff,270px 20px #fff,120px 230px #fff,350px -1px #fff,150px 369px #fff;animation-delay:.8s;}
        .card:hover .heading::before,.card:hover .icons::before,.card:hover .icons::after{filter:blur(3px)}

        .heading::after{
            content:"";
            top:-8.5%;left:-8.5%;
            position:absolute;
            width:7.5em;height:7.5em;
            border-radius:50%;
            background:#f9f9fb;
            box-shadow:0px 0px 100px rgba(193,119,241,.8),0px 0px 100px rgba(135,42,211,.8),inset #9b40fc 0px 0px 40px -12px;
            transition:.4s ease-in-out;
            z-index:-1;
        }
        .card:hover .heading::after{
            box-shadow:0px 0px 200px rgba(193,119,241,1),0px 0px 200px rgba(135,42,211,1),inset #9b40fc 0px 0px 40px -12px;
        }

        .icons{
            display:flex;align-items:center;justify-content:center;flex-direction:row;
            column-gap:1em;z-index:1;
        }
        .instagram,.x,.discord{position:relative;transition:.4s ease-in-out;}
        .instagram:after,.x:after,.discord:after{
            content:"";position:absolute;width:.5em;height:.5em;left:0;background:white;
            box-shadow:0px 0px 10px rgba(233,233,233,.5);border-radius:50%;z-index:-1;transition:.3s ease-in-out;
        }
        .instagram svg path,.x svg path,.discord svg path{stroke:#808080;transition:.4s ease-in-out;}
        .instagram:hover svg path{stroke:#cc39a4}.x:hover svg path{stroke:black}.discord:hover svg path{stroke:#8c9eff}
        .instagram:hover svg{scale:1.4}.x:hover svg,.discord:hover svg{scale:1.25}
        .instagram:hover:after,.x:hover:after,.discord:hover:after{scale:4;transform:translateX(.09em) translateY(.09em);}

        .instagram::before,.x::before,.discord::before{
            content:"";position:absolute;rotate:-45deg;width:5em;height:1px;
            background:linear-gradient(90deg,#ffffff,transparent);animation:4s shootingStar ease-in-out infinite;
        }
        .instagram::before{top:-700%;left:1050%;animation-delay:1s}
        .x::before{top:-1300%;left:850%;animation-delay:3s}
        .discord::before{top:-2100%;left:850%;animation-delay:5s}
        .card:hover .instagram::before,.card:hover .x::before,.card:hover .discord::before{filter:blur(3px)}

        .info-box{
            background:rgba(255,255,255,.1);
            backdrop-filter:blur(10px);
            padding:16px;border-radius:15px;
            margin:15px auto;max-width:500px;
            border-left:4px solid #9b40fc;
            font-size:.95em;text-align:center;flex-shrink:0;
        }
        .stats{
            display:flex;justify-content:center;gap:3em;
            padding:15px 0;background:rgba(0,0,0,.3);
            flex-wrap:wrap;flex-shrink:0;
        }
        .stat-number{
            font-size:2.5em;font-weight:bold;color:#9b40fc;
        }

        @keyframes move{
            0%,100%{transform:translate(0,0)}
            25%{transform:translate(-1em,-1em) rotate(-10deg)}
            50%{transform:translate(-1em,1em)}
            75%{transform:translate(1em,-1.25em) rotate(10deg)}
        }
        @keyframes glowing-stars{
            0%,100%{opacity:0}
            50%{opacity:1}
        }
        @keyframes shootingStar{
            0%{transform:translateX(0) translateY(0);opacity:1}
            50%{transform:translateX(-55em) translateY(0);opacity:1}
            70%{transform:translateX(-70em) translateY(0);opacity:0}
            100%{transform:translateX(0) translateY(0);opacity:0}
        }

        @media (max-width:480px){
            :root{--card-w:17em;--card-h:23em}
            .header h1{font-size:2.1em}
            .grid{gap:1.5em;padding:10px 5px 20px}
            .ranking-wrapper { margin: 15px 10px; padding: 15px; }
            .ranking-title { font-size: 1.4em; }
            .ranking-table th, .ranking-table td { padding: 10px 6px; font-size: 0.85em; }
            .student-name-rank { max-width: 120px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>11D1</h1>
            <p>Lớp 11D1 - Năm Học 2025 - Học Kỳ 1</p>
        </div>

        <!-- BẢNG XẾP HẠNG -->
        <div class="ranking-wrapper">
            <div class="ranking-title">BẢNG XẾP HẠNG</div>
            <div id="rankingLoading" class="loading-rank">Đợi một tí bro...</div>
            <div class="ranking-table-container" id="rankingTableContainer" style="display:none;">
                <table class="ranking-table" id="rankingTable">
                    <thead>
                        <tr>
                            <th>Hạng</th>
                            <th>Họ và tên</th>
                            <th>ĐTB</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody"></tbody>
                </table>
            </div>
        </div>

        <!-- GRID HỌC SINH -->
        <div class="grid" id="studentGrid"></div>

        <div class="info-box">
            <p>Copyright © 2025 Thạch Mô Ra (Rov)</p>
        </div>

        <div class="stats">
            <div><span class="stat-number" id="totalStudents">0</span><br>Học Sinh</div>
            <div><span class="stat-number">11D1</span><br>Lớp</div>
        </div>
    </div>

    <script>
        const BASE_URL = "https://s19.vnedu.vn/v5/?call=app.mobile.hocsinh.getSLLView&app_truong_id=601067905&lop_hoc_id=5003407987&session_id=9d47affc-6f0b-4c86-902a-85f02cde0716&device_id=3f638bbb-df36-39bc-aa2f-76ebbfeb76e4&token=cb96a36858bb639cc34e5e8a0ef43a39&nam_hoc=2025&hoc_ky_id=1&hoc_sinh_id=";

        const students = [
            {name:"Lại Quế Anh",id:"5010453507"},{name:"Lý Ngọc Lan Anh",id:"5010453527"},
            {name:"Nguyễn Thị Ngọc Anh",id:"5010453547"},{name:"Thạch Kim Anh",id:"5010453567"},
            {name:"Huỳnh Tuyết Băng",id:"5010453587"},{name:"Ông Thị Tuyết Chi",id:"5010453607"},
            {name:"Lê Phong Dân",id:"5010453627"},{name:"Trần Thị Hồng Diệp",id:"5010453647"},
            {name:"Lâm Trường Duy",id:"5010453667"},{name:"Nguyễn Lâm Nhật Duy",id:"5010453687"},
            {name:"Tăng Phước Đại",id:"5010453707"},{name:"Mai Lan Em",id:"5010453727"},
            {name:"Phạm Tấn Đạt",id:"5010454367"},{name:"Huỳnh Ngọc Giao",id:"5010453747"},
            {name:"Lưu Gia Hân",id:"5010453767"},{name:"Nguyễn Ngọc Gia Hân",id:"5010453787"},
            {name:"Huỳnh Văn Hóa",id:"5010453807"},{name:"Du Lý Gia Khang",id:"5010454387"},
            {name:"Lưu Vỹ Khang (Anh Hai)",id:"5010453827"},{name:"Nguyễn Thanh Lâm",id:"5010453847"},
            {name:"Trần Lâm",id:"5010453867"},{name:"Triệu Thị Ngọc Linh",id:"5010453887"},
            {name:"Hứa Kim Lượng",id:"5010453907"},{name:"Quách Thảo My",id:"5010453947"},
            {name:"Lâm Kim Ngân",id:"5010453967"},{name:"Trịnh Khưu Mỹ Nghi",id:"5010453987"},
            {name:"Ong Thị Bảo Ngọc",id:"5010454007"},{name:"Phan Nguyễn Nhã Nguyên",id:"5010454027"},
            {name:"Lâm Đặng Phượng Quyên",id:"5010454047"},{name:"Nguyễn Thị Xuân Quỳnh",id:"5010454067"},
            {name:"Thạch Mô Ra",id:"5010454087"},{name:"Huỳnh Hoàng Tấn",id:"5010454107"},
            {name:"Nguyễn Tấn Thịnh",id:"5010454127"},{name:"Trần Thị Anh Thư",id:"5010454147"},
            {name:"Lâm Ngọc Hoài Thương",id:"5010454167"},{name:"Nguyễn Thị Ngọc Tiến",id:"5010454187"},
            {name:"Châu Thị Thủy Trúc",id:"5010454207"},{name:"Triệu Thanh Tú",id:"5010454227"},
            {name:"Dương Thị Bích Tuyền",id:"5010454247"},{name:"Trần Văn Tý",id:"5010454267"},
            {name:"Dương Thị Ngọc Vy",id:"5010454287"},{name:"Trịnh Thị Kim Yến",id:"5010454327"},
            {name:"Huỳnh Công Vinh",id:"5010454347"}
        ];

        const grid = document.getElementById('studentGrid');
        document.getElementById('totalStudents').textContent = students.length;

        const frag = document.createDocumentFragment();
        students.forEach(s => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="image">
                    <img src="anh11d1.jpg" alt="11D1" loading="lazy">
                </div>
                <div class="heading">${s.name}</div>
                <div class="icons">
                    <div class="instagram"><svg viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg></div>
                    <div class="x"><svg viewBox="0 0 24 24"><path d="M18.9,1.15H5.1A4.1,4.1 0 0,0 1,5.25V18.75A4.1,4.1 0 0,0 5.1,22.85H18.9A4.1,4.1 0 0,0 23,18.75V5.25A4.1,4.1 0 0,0 18.9,1.15M17.35,9.61L12.5,14.68L7.65,9.61L5.85,11.41L10.7,16.28L5.85,21.15L7.65,22.95L12.5,18.08L17.35,22.95L19.15,21.15L14.3,16.28L19.15,11.41L17.35,9.61Z"/></svg></div>
                    <div class="discord"><svg viewBox="0 0 24 24"><path d="M20.22 8.43A13.86 13.86 0 0,0 16.56 6.3 13.47 13.47 0 0,0 15.89 4L15.65 3.5A14.13 14.13 0 0,0 12 3.2 14.13 14.13 0 0,0 8.35 3.5L8.11 4A13.47 13.47 0 0,0 7.44 6.3 13.86 13.86 0 0,0 3.78 8.43 14.05 14.05 0 0,0 2 14.9A14.4 14.4 0 0,0 8.13 18.5L8.6 17.8A10.08 10.08 0 0,1 6.5 15.7L7.2 15.3A9.85 9.85 0 0,0 12 16.5A9.85 9.85 0 0,0 16.8 15.3L17.5 15.7A10.08 10.08 0 0,1 15.4 17.8L15.87 18.5A14.4 14.4 0 0,0 22 14.9A14.05 14.05 0 0,0 20.22 8.43M8.5 14C7.67 14 7 13.33 7 12.5S7.67 11 8.5 11 10 11.67 10 12.5 9.33 14 8.5 14M15.5 14C14.67 14 14 13.33 14 12.5S14.67 11 15.5 11 17 11.67 17 12.5 16.33 14 15.5 14Z"/></svg></div>
                </div>
            `;
            card.onclick = () => window.open(BASE_URL + s.id, '_blank');
            frag.appendChild(card);
        });
        grid.appendChild(frag);

        async function fetchStudentGrades(studentId) {
            const url = `${BASE_URL}${studentId}`;
            try {
                const response = await fetch(url, { method: 'GET', credentials: 'omit' });
                if (!response.ok) return null;
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                let avg = 0, count = 0;
                const tbmCells = doc.querySelectorAll('.table-point-content .table tbody th.text-center');
                tbmCells.forEach(cell => {
                    const score = parseFloat(cell.textContent.trim());
                    if (!isNaN(score)) { avg += score; count++; }
                });

                if (count === 0) {
                    const gkCells = doc.querySelectorAll('span.border-custom');
                    gkCells.forEach(cell => {
                        const score = parseFloat(cell.textContent.trim());
                        if (!isNaN(score)) { avg += score; count++; }
                    });
                }

                return count > 0 ? (avg / count).toFixed(2) : null;
            } catch (err) {
                console.warn(`Lỗi HS ${studentId}:`, err);
                return null;
            }
        }

        async function loadRanking() {
            const loadingEl = document.getElementById('rankingLoading');
            const containerEl = document.getElementById('rankingTableContainer');
            const bodyEl = document.getElementById('rankingBody');

            const results = await Promise.all(
                students.map(async (s) => {
                    const avg = await fetchStudentGrades(s.id);
                    return { name: s.name, avg: avg ? parseFloat(avg) : null };
                })
            );

            const validResults = results
                .filter(r => r.avg !== null)
                .sort((a, b) => b.avg - a.avg);

            if (validResults.length === 0) {
                loadingEl.textContent = "Không thể tải điểm. Vui lòng thử lại.";
                return;
            }

            validResults.forEach((item, index) => {
                const tr = document.createElement('tr');
                const rank = index + 1;
                const badgeClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';

                tr.innerHTML = `
                    <td><span class="rank-badge ${badgeClass}">${rank}</span></td>
                    <td class="student-name-rank" title="${item.name}">${item.name}</td>
                    <td class="avg-score">${item.avg}</td>
                `;
                bodyEl.appendChild(tr);
            });

            loadingEl.style.display = 'none';
            containerEl.style.display = 'block';
        }

        window.addEventListener('load', () => {
            setTimeout(loadRanking, 800);
        });
    </script>
</body>
</html>
